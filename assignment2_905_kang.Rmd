---
output:
  html_notebook:
    css: custom.css
---

## Prenatal stage 에 따른 Dorsolateral prefrontal cortex 에서의 protein coding gene expression 분석

첫 번째 plot 이후의 코멘트이다.

> 코멘트1  
•	이 그래프는 prenatal stage별로 protein coding gene expression이 어떻게 나타나는지를 색으로 구분하여 나타낸 plot이다. 색으로 rate를 나타냄으로써 한눈에 어느 data가 rate가 높고 낮은지를 구별할 수 있다. 예를 들어, stage 3A에서는 TMSB10, ACTG1 gene의 expression rate가 매우 높고 그에 비해 GFAP gene의 expression rate는 낮다.  
•	이와 같은 색 구별은 숫자를 일일이 비교하는 과정 없이 상대적으로 데이터들을 비교하는 데 용이하다는 장점이 있다. 숫자를 대조할 필요 없이 한눈에 색의 진하기를 판단할 수 있기 때문에 빈도를 파악하기에 매우 좋은 plot 형식이다. 이의 단점은, 값이 상대적인 색의 세기로 나타나기 때문에 데이터들의 정확한 rate 수치는 알기 어렵다는 점이다. 데이터들끼리 상대적으로 어떤 데이터가 빈도가 더 높고 낮은지는 확연하게 구별되지만 각각의 한개의 칸이 몇의 rate를 표현하고 있는지는 대략적인 값은 알 수 있으나 구체적으론 알기 어려우며 주관적으로 해석될 여지가 있다. 또한 색 해석에 어려움이 있는 경우 색으로 그래프를 해석하기가 어려울 수 있다.  
•	그렇지만 정확한 rate값이 필요하지 않고 상대적 세기를 아는 것이 원하는 데이터라면 이와 같이 색의 세기로 plot을 그리는 것은 매우 적절한 plot 형식이라고 생각된다. 정확하지는 않으나 heatmap 함수를 사용해서 그래프를 그린 것으로 예상된다.


> 코멘트 2  
•	이 그래프는 태아의 발달 단계에 따라 각 DFC protein coding gene이 발현되는 정도를 나타낸 그래프이다. x축을 따라 태아 발달 단계를 따라가고, y축에는 각 유전자들이 나열되어 있다. 이때 각 칸을 채우는 색이 해당 단계에서 각 유전자가 발현되는 정도를 나타낸 것인데, legend에서 나타나듯 rate가 낮을 수록 연한 노란색에 가까워지고, 높을 수록 검은 붉은색에 가까워진다.  
•	태아에서 DFC를 합성하는 유전자는 주로 TUBA1A, TMSB10, ACTG1을 들 수 있을 것이다. 또한 각 유전자가 주로 발현되는 시기가 다른데, 모두 rate이 2000을 넘을 정도로 높은 발현을 보이나, TUBA1A, TMSB10는 주로 stage 4에서 발현량이 가장 높고, ACTG1의 경우 stage 2A와 같이 초기에 많은 발현을 보이는 편이다.  
•	이렇게 색을 이용하여 많은 수의 유전자 발현을 시간별로 나타내는 것은 굉장히 눈에 쉽게 들어온다. 많이 발현되는 유전자와 각 유전자가 가장 많이 발현되는 시기를 color gradient를 이용해 직관적으로 표현하고 있다. 조금 아쉬운 점이 있다면, y축이 단순히 알파벳순으로 나열되어 있는데, 발현량 순서대로 정렬이 되었다면 또는 각 시기별로 가장 많이 발현되는 유전자를 표시할 수 있다면 태아시기 DFC 단백질 합성에 주로 발현되는 유전자를 더 쉽게 파악할 수 있을 것 같다.

코멘트를 반영하면, 선별한 유전자를 알파벳순이 아닌 발현되는 순서로 바꾸어 plot을 그리는게 적절하다고 생각된다.  
또한 애매한 용어인 rate 대신 조금 더 직관적인 scale을 이용하였다.

```{r}
a <- cbind(e,g)
prenatal_stage <- a %>%
  filter(gene_type == "protein_coding") %>%
  rowwise() %>%
  mutate(stage_2A = median(!!quo(c(X1, X2))),
         stage_2B = median(!!quo(c(X3, X4, X5))),
         stage_3A = median(!!quo(c(X6, X7, X8))),
         stage_3B = median(!!quo(c(X9, X10, X11, X12))),
         stage_4 = median(!!quo(c(X13, X14))),
         stage_5 = median(!!quo(c(X15, X16, X17)))) %>%
  select(stage_2A, stage_2B, stage_3A, stage_3B, stage_4, stage_5, gene_symbol, gene_type) %>%
  filter(stage_2A > 700 | stage_2B > 700 | stage_3A > 700 | stage_3B > 700 | stage_4 > 700 | stage_5 > 700) %>%
  gather(key = 'stage', value = 'scale', stage_2A:stage_5)
```

```{r}
prenatal_stage %>%
  ggplot(aes(stage, gene_symbol, fill = scale)) +
  geom_tile() +
  scale_fill_gradientn(colors = brewer.pal(9, "YlOrBr")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text = element_text(color = "black")) +
  ggtitle("DFC protein coding gene expression at prenatal stages") +
  xlab("") +
  ylab("")
```

```{r}
prenatal_stage %>%
  mutate(gene_symbol = reorder(gene_symbol, scale)) %>%
  ggplot(aes(stage, gene_symbol, fill = scale)) +
  geom_tile() +
  scale_fill_gradientn(colors = brewer.pal(9, "YlOrBr")) +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        axis.text = element_text(color = "black")) +
  ggtitle("DFC protein coding gene expression at prenatal stages") +
  xlab("") +
  ylab("")
```

이렇게 정리하니 많이 발현되는 유전자 순서대로 볼 수 있어서 이전 plot보다 더 한눈에 들어온다.  
이전 plot에서는 알파벳 순서로 인해 서로 떨어져 있었고, 색 차이가 많이 나지않아 TUBA1A가 ACTG1 보다 더 많이 발현되어 보이기도 했는데, 이렇게 보니 stage 2A에서 ACTG1이 stage 4에서 TUBA1A보다 더 많이 발현된다는 것을 알 수 있다.

그러나 plot을 자세하게 보면, 특정한 stage에서 발현율이 위에 있는 유전자보다 더 높은데 순서가 아래에 있는 것을 볼 수 있다. 이유를 알아보기 위해 EEF2와 RPS11 유전자의 전체 scale의 총합을 구해보았다.

```{r}
prenatal_stage %>%
  filter(gene_symbol == c("EEF2", "RPS11")) %>%
  group_by(gene_symbol) %>%
  summarize(sum = sum(scale))
```

Stage 2A와 stage 4에서 RPS11의 발현양이 더 높음에도 불구하고, 총 발현량이 EEF2가 더 높기 때문에 scale 순서대로 정렬했을 때 EEF2가 더 위에 있게 된다.

코멘트1에서 말한 것과 같이 정확한 수치는 알 수 없기 때문에 stage 3A에서 TMSB10과 ACTG1 중 어느 유전자가 더 많이 발현되는지 정확하게 알 수 없는 것은 geom_tile plot의 한계라고 생각한다. 따라서 정확한 수치를 비교하기 위해서는 heatmap보다는 geom_point와 `facet_wrap`을 이용한 stage별 비교가 더 좋을 것이라 생각했다.

```{r}
prenatal_stage %>%
  mutate(gene_symbol = reorder(gene_symbol, scale)) %>%
  ggplot(aes(gene_symbol, scale)) +
  geom_point(size = 1) +
  facet_wrap(~stage) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        axis.text = element_text(color = "black"),
        panel.background = element_blank(),
        panel.grid = element_line(color = "grey80"),
        plot.title = element_text(hjust = 0.5)) +
  ggtitle("DFC protein coding gene expression at prenatal stages") +
  xlab("")
```

Stage마다 발현되는 유전자의 scale이 달라서 발현 순서대로 나열되지 않은 plot도 있고, 19개 유전자를 표현하다보니 복잡하지만, 어떤 stage에서 어떤 유전자가 더 발현되는지를 geom_tile보다는 수치적으로 좀 더 쉽게 알 수 있다. 따라서 수치적인 비교를 원한다면 유전자의 수를 줄여서 이런 방식으로 나타내거나, 각 stage별로 plot을 그린 다음 `plot_grid()`를 이용하여 합쳐도 좋을 것 같다.

사용된 data set의 정리와 이전 plot은 [assingment1_905_kang](https://htmlpreview.github.io/?https://github.com/kminji105/bsms222_905_kang/blob/master/assignment1_905_kang.nb.html)에서 볼 수 있다.
